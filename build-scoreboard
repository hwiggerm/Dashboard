drop table load_sup_dashboard
;

create table load_sup_dashboard (
  load date,
  booking_credit_current number,
  booking_credit_next number,
  booking_credit_future number,
  booking_credit_next_fy number
  )
;

create or replace procedure sub_dashboard
is
cursor load_dates_cur is
   SELECT distinct(load)
     FROM load_fywip;

  bc_current number ;
  bc_next number ;
  bc_future number ;
  bc_nextfy number ;


  /* program starts */
  BEGIN

  /* booking credits - Next */
  /* open load_dates_cur; */
  for ld_rec in load_dates_cur loop
  
    Select sum(booking_credit) into bc_next
    from load_fywip
    where FCST_SEGMENT='Bookings' and
    LOAD = ld_rec.load and
    QUARTER in ('Next');
 
    Select sum(booking_credit) into bc_current
    from load_fywip
    where FCST_SEGMENT='Bookings' and
    LOAD = ld_rec.load and
    QUARTER in ('Current');

    Select sum(booking_credit) into bc_future
    from load_fywip
    where FCST_SEGMENT='Bookings' and
    LOAD = ld_rec.load and
    QUARTER in ('Future');

    Select sum(booking_credit) into bc_nextFY
    from load_fywip
    where FCST_SEGMENT='Bookings' and
    LOAD = ld_rec.load and
    QUARTER in ('Future FY');

    /* now insert it into the table  */
    insert into load_sup_dashboard (
      load,
      booking_credit_current,
      booking_credit_next,
      booking_credit_future,
      booking_credit_next_fy)
      values (
      ld_rec.load,
      bc_current,
      bc_next,
      bc_future,
      bc_nextfy)
      ;
      
    end loop;

END;
/

execute sub_dashboard ;
