drop table load_sup_dashboard
;

create table load_sup_dashboard (
  load date,
  booking_credit_current_v number,
  booking_credit_next_v number,
  booking_credit_future_v number,
  booking_credit_next_fy_v number
  booking_credit_current_a number,
  booking_credit_next_a number,
  booking_credit_future_a number,
  booking_credit_next_fy_a number

  )
;

create or replace procedure sub_dashboard
is
cursor load_dates_cur is
   SELECT distinct(load)
     FROM load_fywip;

     bc_current_v number ;
     bc_next_v number ;
     bc_future_v number ;
     bc_nextfy_v number ;

     bc_current_a number ;
     bc_next_a number ;
     bc_future_a number ;
     bc_nextfy_a number ;


  /* program starts */
  BEGIN

  /* booking credits - Next */

  for ld_rec in load_dates_cur loop

    Select sum(booking_credit), count(distinct(contract)) into bc_next_v,bc_next_a
    from load_fywip
    where FCST_SEGMENT='Bookings' and
    LOAD = ld_rec.load and
    QUARTER in ('Next');

    Select sum(booking_credit) into bc_current
    from load_fywip
    where FCST_SEGMENT='Bookings' and
    LOAD = ld_rec.load and
    QUARTER in ('Current');

    Select sum(booking_credit) into bc_future
    from load_fywip
    where FCST_SEGMENT='Bookings' and
    LOAD = ld_rec.load and
    QUARTER in ('Future');

    Select sum(booking_credit) into bc_nextFY
    from load_fywip
    where FCST_SEGMENT='Bookings' and
    LOAD = ld_rec.load and
    QUARTER in ('Future FY');







    /* now insert it into the table  */
    insert into load_sup_dashboard (
      load,
      booking_credit_current,
      booking_credit_next,
      booking_credit_future,
      booking_credit_next_fy)
      values (
      ld_rec.load,
      bc_current,
      bc_next,
      bc_future,
      bc_nextfy)
      ;

    end loop;

END;
/

execute sub_dashboard ;
